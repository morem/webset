
<style type="text/css">
.xx{}
li{list-style:none;}
.config{padding:0 0 0 0;margin:0 0 0 0;border:1px solid #cccccc;position:relative;}
.config_items_font{font-size:10px}
.config_items_content_left1{width:50px;}
.config_items_content_left2{width:40px;}
.config_items_content_left3{width:60px;}
.config_items_content_left4{width:370px;}
.config_items_content_left5{width:80px;}
.config_items_content_left6{width:80px;}
.config_items_content_left7{width:80px;}
#id_config_items_content {background:#eeeeee;}
.config_items_content > div{clear:both;border:1px #cccccc solid;}
#id_config_items_content li:hover{background:#4281B7;}
.config_items_title{padding:3px 0 3px 10px;margin:0px 0 0 0 ; height:16px}
.config_items_title > div{float:left;}
.config_items_list{height:450px;overflow-y:scroll;}
.config_items_list > div{clear:both;height:50px;}
.config_items_item {background:#eeeeee;padding:5px 0 5px 0;border-bottom:1px #cccccc solid;}
.config_items_item_odd {background:#ffffff;}
.config_items_item > div {float:left;}
.config_items_item img {height:50px;width:50px;}
#id_config_items_content .config_items_item_button{border-left:1px solid #cccccc;top:padding-left:5px;}
.page_nav > div {float:left;}
.page_nav li {float:left;border:1px #cccccc solid;padding:0 3px 0 3px; margin:10px 5px 0 5px;}
#id_config_items_show_info{border:0;margin-left:100px;margin-right:50px;}
#id_config_items_item_sort{margin:0 0 0 0;padding:0 0 0 15px; height:16px;}
#id_config_items_item_sort:hover{background:#4281B7;}

</style>

<div class="config" id="id_show_config">
	<!--<div class="config_search">
	<#include "config_introduct.html">-->
	<#include "config_content.html">
	</div>
	<div class="config_items_content config_items_font" id="id_config_items_content" title="Basic modal dialog">
        <#include "config_search.html">
        <div class="config_items_title" id="id_config_items_title">
        	<div class="config_items_content_left1">
            	<input type="checkbox" name="select_all" id="items_select_all"/>
        		<label for="items_select_all">全选</label>
        	</div>
        	<div class="config_items_content_left2">
        		状态
        	</div>            
        	<div class="config_items_content_left3">
        		缩略图
        	</div>
        	<div class="config_items_content_left4" style="text-align:center;">
        		商品标题
        	</div>
        	<div class="config_items_content_left5" id="id_config_items_item_sort">
        		<a>当前状态</a>
        	</div>
        </div>
        
        <div class="config_items_list" id="id_items_list"></div>
        <div class="page_nav" id="id_config_items_page_nav">
            <div class ="page_nav_operator" id="id_config_items_page_nav_bat">
                <li id="id_config_items_page_nav_force_inshow" title="index.html/showdatamanager?action=forceShow"><a>加入强制推荐</a></li>
                <li id="id_config_items_page_nav_force_no_inshow" title="index.html/showdatamanager?action=forbidShow"><a>加入禁止推荐</a></li>
                <li id="id_config_items_page_nav_normal" title="index.html/showdatamanager?action=normalShow"><a>恢复普通推荐</a></li>
                <li class="config_items_show_info" id="id_config_items_show_info">已强制推荐个数<b>10</b></li>
            </div>
        
            <li title="index.html/showconfigitemmanager?action=head"><a>头页</a></li>
            <li title="index.html/showconfigitemmanager?action=pre"><a>上页</a></li>
            <li><input type="text" value="1" id="id_config_items_jmp_to"style="width:20px;margin:0 0px 0 0px;"/></li>
            <li id="id_config_items_page_nav_total">5</li>
            <li title="index.html/showconfigitemmanager?action=jmpto"><a>跳到</a></li>
            <li title="index.html/showconfigitemmanager?action=next"><a>下页</a></li>
            <li title="index.html/showconfigitemmanager?action=tail"><a>尾页</a></li>
        </div>
        <li id="id_config_status" value="config" style="display:none;"></li>
        <li id="id_dummy"  style="display:none;"></li>
    </div>
</div>

<script type="text/javascript">
function getAllInfo()
{
    var $keyword = $("#id_config_items_keyword").val();
    var $cat = $("#id_config_items_search_cata").find("option:selected").val();
    var $inshow =  $("#id_config_items_inshow").find("option:selected").val();
    var $sort =  $("#id_config_items_sort").find("option:selected").val();
    var $pitem =  $("#id_config_items_page_item_no").find("option:selected").val();
    var $jmpto =  $("#id_config_items_jmp_to").val();
    var $curpage =  $("#id_config_items_curpage").val();
    var $status = $("#id_config_status").text();
    var $idlist ="id=";
    $("#id_items_list :checkbox").each(function(){
        if ($(this).attr("checked") == "checked")
        {
              $idlist = $idlist +  $(this).attr("id") +":";
        }
    });
    
    console.log ("cur_page:" + $(id_config_items_curpage).attr("value"));
    console.log("keyword:"+$keyword);
    console.log("cat:"+$cat);
    console.log("inshow:"+$inshow);
    console.log("pitem:"+$pitem);
    console.log("jmpto:"+$jmpto);
    console.log("idlist:"+$idlist);
    console.log("curpage:"+$curpage);
    console.log("status:"+$status);
    console.log("&" + $idlist + "&keyword=" + $keyword + "&cat=" + $cat + "&inshow=" + $inshow + "&sort="+ $sort + "&pitem="+ $pitem + "&jmpto="+ $jmpto);
    
    return encodeURI($idlist + "&keyword=" + $keyword + "&cat=" + $cat + "&inshow=" + $inshow + "&sort="+ 
                     $sort + "&pitem="+ $pitem + "&jmpto="+ $jmpto + "&curpage="+$curpage + "&status=" + $status);
}

function getAllItemSelect()
{
    var $list = new Array();
    $("#id_items_list :checkbox").each(function(){
        if ($(this).attr("checked") == "checked")
        {
                $list.push($(this).attr("id"));
        }
    });
    return $list;    
}

$(document).ready(function(){

    $("#id_config_items_content").hide();
    
    
    
    
    $("#id_config_items_page_nav_bat li").livequery("click", function(){
        var $list = getAllItemSelect();
        var $str = "";
        var $to = $(this).attr("title");
		var _self = this;
		
		if ($(this).attr("id") == "id_config_items_show_info")return;
		
		
		$to = "${ip}/" + $to;
		
        console.log ($list);
        
         
        for ($i = 0; $i < $list.length; $i=$i + 1)
            $str = $list[$i] + ":" + $str;
        
        $to = $to  + "&ct=2&"  + "&id=" + $str;
        console.log ($to);
        $("#runing").dialog('open');
        
       // $("#id_dummy").load($to,
        $.get($to,
            function(data, textStatus){
                console.log("-data-" + data);
                console.log("-textStatus-" + textStatus);
                if (textStatus == "success")
                {
                    console.log("-textStatus-" + "success");
                    if (data == "success_force" || data == "success_forbid" || data == "success_normal")
                    {
                        var $list = getAllItemSelect();
                        for ($i = 0; $i < $list.length; $i = $i + 1)
                        {
                            var $item = $("#" + $list[$i] + "_status");
                            var $itemCheck = $("#" + $list[$i]);
                            var $itemForce = $("#" + $list[$i] + "_force");
                            var $itemForbid = $("#" + $list[$i] + "_forbid");
                            var $itemNormal = $("#" + $list[$i] + "_normal");

                            if (data == "success_force")
                            {
                                $item.text("已被始终推荐");
                                $itemForce.attr("style","margin:20px 0 0 0;padding-left:2px;display:none;");
                                $itemForbid.attr("style","margin:20px 0 0 0;padding-left:2px;");
                                $itemNormal.attr("style","margin:20px 0 0 0;padding-left:2px;");
                            }
                            else if (data == "success_forbid")
                            {
                                $item.text("已被禁止推荐");
                                $itemForce.attr("style","margin:20px 0 0 0;padding-left:2px;");
                                $itemForbid.attr("style","margin:20px 0 0 0;padding-left:2px;display:none;");
                                $itemNormal.attr("style","margin:20px 0 0 0;padding-left:2px;");
                            }
                            else
                            {
                                $item.text("普通方式");
                                $itemForce.attr("style","margin:20px 0 0 0;padding-left:2px;");
                                $itemForbid.attr("style","margin:20px 0 0 0;padding-left:2px;");
                                $itemNormal.attr("style","margin:20px 0 0 0;padding-left:2px;display:none;");
                            }
                            $itemCheck.attr("checked", false);
                        }  
                    }
                    $("#items_select_all").attr("checked", false);                     
                }                
                $("#runing").dialog('close');    
            })
    })
    
    $("#id_config_items_page_nav > li").livequery("click",function(){
		var $to = $(this).attr("title");
		var _self = this;
		$to = "${ip}/" + $to + "&ct=0&" + getAllInfo();
		$("#runing").dialog('open');
		console.log ("to:" + $to);
				
		$("#id_items_list").load($to,function(){
		    var $cur = $("#id_config_items_curpage").val();
		    var $total = $("#id_config_items_totalpage").val();
		    $("#id_config_items_jmp_to").attr("value", $cur);
		    $("#id_config_items_page_nav_total").text("共"+$total+"页");
		    console.log ("page" + $cur + "/" + $total);
		    $("#runing").dialog('close');
		    $(".config_items_item:odd").addClass("config_items_item_odd");
		});
    })

    $("#id_config_search_button").livequery("click",function(){
		var $to = $(this).attr("title");
		var _self = this;
		$to = "${ip}/" + $to + "&ct=0&" + getAllInfo();
		$("#runing").dialog('open');
		//console.log ("to:" + $to);
				
		$("#id_items_list").load($to,function(){
		    var $cur = $("#id_config_items_curpage").val();
		    var $total = $("#id_config_items_totalpage").val();
		    $("#id_config_items_jmp_to").attr("value", $cur);
		    $("#id_config_items_page_nav_total").text("共"+$total+"页");
		    console.log ("page" + $cur + "/" + $total);
		    $("#runing").dialog('close');
		    $(".config_items_item:odd").addClass("config_items_item_odd");
		});
    })
    
    
	$("#select_show_forever").livequery("click",function(){
		var $to = $(this).attr("title");
		var _self = this;
		$to = "${ip}/" + $to + "&ct=0"
		$("#runing").dialog('open');
		
		$("#id_items_list").load($to,function(){
		    $("#id_config_items_content").dialog({
			    height: 600,
		        width: 900,
		        draggable:true,
		        resizable:true,
                modal: true,
                title: "选择始终推荐的商品(细化的搜索条件，有利于提高工作效率)"      
		        });
		    var $cur = $("#id_config_items_curpage").val();
		    var $total = $("#id_config_items_totalpage").val();
		    $("#id_config_items_jmp_to").attr("value", $cur);
		    $("#id_config_items_page_nav_total").text("共"+$total+"页");
		    $("#id_config_status").text("forever");
		    
		    $("#runing").dialog('close');
		    $(".config_items_item:odd").addClass("config_items_item_odd");
		});
	})

	$("#select_show_never").livequery("click",function(){
		var $to = $(this).attr("title");
		var _self = this;
		$to = "${ip}/" + $to + "&ct=0"
		$("#id_items_list").load($to,function(){$("#runing").removeClass("cover_active");});
		$( "#id_config_items_content" ).dialog({
		    height: 500,
		    width: 900,
            modal: true,
            title: "Dialog Title" ,
            zIndex:1000,
	    });
	})

    $("#items_select_all").livequery("change",function(){
       if ($("#items_select_all").attr("checked") == "checked")
           $(".config_items_checkbox input").attr("checked",true);
       else
           $(".config_items_checkbox input").attr("checked",false);  
    });
});
</script>